<div class="container py-4">
  <div class="row">
    <div class="col-lg-8 mx-auto">
      <div class="card shadow-sm">
        <div class="card-header bg-white border-bottom">
          <div class="d-flex justify-content-between align-items-center">
            <h1 class="h4 mb-0">Edit Maintenance</h1>
            <div>
              <span class="badge bg-primary me-2">
                <%= @vehicle.make %> <%= @vehicle.model %> (<%= @vehicle.registration_number %>)
              </span>
              <span class="badge <%= @maintenance.status == 'Completed' ? 'bg-success' : 'bg-warning' %>">
                <%= @maintenance.status %>
              </span>
            </div>
          </div>
        </div>
        <div class="card-body">
          <%= render "form", vehicle: @vehicle, maintenance: @maintenance, service_providers: @service_providers %>
        </div>
        <div class="card-footer bg-white border-top">
          <div class="d-flex justify-content-between">
            <%= link_to vehicle_path(@vehicle), class: "btn btn-outline-secondary" do %>
              <i class="bi bi-arrow-left me-2"></i>Back to Vehicle
            <% end %>
            <div>
              <%= link_to "View Details", vehicle_maintenance_path(@vehicle, @maintenance), class: "btn btn-outline-primary me-2" %>
              <%= link_to "Delete", confirm_delete_vehicle_maintenance_path(@vehicle, @maintenance), class: "btn btn-outline-danger" %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<%= javascript_include_tag "https://cdn.jsdelivr.net/npm/flatpickr" %>
<%= stylesheet_link_tag "https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" %>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // Initialize flatpickr for date fields
  flatpickr(".datepicker", {
    dateFormat: "Y-m-d",
    allowInput: true
  });
  
  // Auto-calculate end date if only start date is provided
  const startDateField = document.getElementById('maintenance_start_date');
  const endDateField = document.getElementById('maintenance_end_date');
  
  startDateField?.addEventListener('change', function() {
    if (endDateField && !endDateField.value) {
      const startDate = new Date(this.value);
      startDate.setDate(startDate.getDate() + 7);
      endDateField.value = startDate.toISOString().split('T')[0];
    }
  });
});
</script>