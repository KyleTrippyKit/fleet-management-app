<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="mb-2"><%= @vehicle.make %> <%= @vehicle.model %> - Trips</h1>
      <p class="text-muted mb-0">
        Registration: <code><%= @vehicle.registration_number %></code> | 
        Service Owner: <%= @vehicle.service_owner %>
      </p>
    </div>
    <%= link_to "Back to Analytics", analytics_vehicles_path, class: "btn btn-outline-secondary" %>
  </div>

  <!-- Filter Form -->
  <%= form_with url: trips_vehicle_path(@vehicle), method: :get, local: true, class: "row g-3 align-items-end mb-4 shadow-sm p-3 rounded" do %>
    <div class="col-md-4">
      <%= label_tag :from, "From Date", class: "form-label fw-semibold" %>
      <%= date_field_tag :from, @from_date, class: "form-control form-control-sm" %>
    </div>
    
    <div class="col-md-4">
      <%= label_tag :to, "To Date", class: "form-label fw-semibold" %>
      <%= date_field_tag :to, @to_date, class: "form-control form-control-sm" %>
    </div>
    
    <div class="col-md-4">
      <%= label_tag :status, "Status", class: "form-label fw-semibold" %>
      <%= select_tag :status, 
            options_for_select(["All", "Completed", "In Progress"], params[:status] || "All"),
            class: "form-select form-select-sm" %>
    </div>
    
    <div class="col-md-12 mt-2">
      <%= submit_tag "Filter", class: "btn btn-primary btn-sm w-100" %>
    </div>
  <% end %>

  <!-- Summary Stats -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <h5 class="card-title"><%= @total_trips %></h5>
          <p class="card-text text-muted">Total Trips</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <h5 class="card-title"><%= @total_distance %> km</h5>
          <p class="card-text text-muted">Total Distance</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <h5 class="card-title"><%= @total_hours %> hrs</h5>
          <p class="card-text text-muted">Total Hours</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <h5 class="card-title"><%= @avg_distance %> km</h5>
          <p class="card-text text-muted">Avg. Distance/Trip</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Trips Table -->
  <% if @trips.any? %>
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Start Time</th>
                <th>End Time</th>
                <th>Duration</th>
                <th>Distance</th>
                <th>Driver</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <% @trips.each do |trip| %>
                <tr>
                  <td><%= trip.start_time.strftime("%Y-%m-%d %H:%M") %></td>
                  <td><%= trip.end_time&.strftime("%Y-%m-%d %H:%M") || "N/A" %></td>
                  <td><%= trip.formatted_duration %></td>
                  <td><%= trip.formatted_distance %></td>
                  <td><%= trip.driver&.name || "Not assigned" %></td>
                  <td>
                    <span class="badge bg-<%= trip.status_class %>">
                      <%= trip.status %>
                    </span>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
        
        <!-- Pagination -->
        <% if @trips.total_pages > 1 %>
          <nav class="mt-4">
            <ul class="pagination justify-content-center">
              <% if @trips.prev_page %>
                <li class="page-item">
                  <%= link_to "Previous", trips_vehicle_path(@vehicle, page: @trips.prev_page, from: @from_date, to: @to_date, status: params[:status]), class: "page-link" %>
                </li>
              <% else %>
                <li class="page-item disabled">
                  <span class="page-link">Previous</span>
                </li>
              <% end %>
              
              <% (1..@trips.total_pages).each do |page| %>
                <% if page == @trips.current_page %>
                  <li class="page-item active">
                    <span class="page-link"><%= page %></span>
                  </li>
                <% else %>
                  <li class="page-item">
                    <%= link_to page, trips_vehicle_path(@vehicle, page: page, from: @from_date, to: @to_date, status: params[:status]), class: "page-link" %>
                  </li>
                <% end %>
              <% end %>
              
              <% if @trips.next_page %>
                <li class="page-item">
                  <%= link_to "Next", trips_vehicle_path(@vehicle, page: @trips.next_page, from: @from_date, to: @to_date, status: params[:status]), class: "page-link" %>
                </li>
              <% else %>
                <li class="page-item disabled">
                  <span class="page-link">Next</span>
                </li>
              <% end %>
            </ul>
          </nav>
        <% end %>
      </div>
    </div>
  <% else %>
    <div class="card shadow-sm">
      <div class="card-body text-center py-5">
        <i class="bi bi-map text-muted" style="font-size: 3rem;"></i>
        <h4 class="mt-3">No trips found</h4>
        <p class="text-muted">No trip records found for this vehicle in the selected period.</p>
        <%= link_to "Change Date Range", "#", onclick: "document.querySelector('form').scrollIntoView(); return false;", class: "btn btn-primary mt-2" %>
      </div>
    </div>
  <% end %>
</div>