<div class="container py-4">
  <h1 class="mb-4">Full Vehicle Details</h1>

  <div class="row">
    <!-- Left Column: Vehicle Image & Basic Info -->
    <div class="col-md-4">
      <div class="card mb-4 shadow-sm">
        <%= image_tag vehicle_image(@vehicle), class: "img-fluid rounded" %>
        <div class="card-body mt-3">
          <h4><%= @vehicle.make %> <%= @vehicle.model %></h4>
          <% if @vehicle.license_plate.present? %>
            <span class="badge bg-secondary"><%= @vehicle.license_plate %></span>
          <% end %>

          <p><strong>Service Owner:</strong> <%= @vehicle.service_owner %></p>
          <p><strong>Type:</strong> <%= @vehicle.vehicle_type %></p>
          <p><strong>Color:</strong> <%= @vehicle.color %></p>
          <p><strong>Chassis Number:</strong> <%= @vehicle.chassis_number.presence || "-" %></p>
          <p><strong>Year:</strong> <%= @vehicle.year_of_manufacture.presence || "-" %></p>
          <p><strong>Mileage:</strong> <%= @vehicle.mileage || "Unknown" %> km</p>

          <!-- Certified Copy Fields -->
          <p><strong>Engine Number:</strong> <%= @vehicle.engine_number.presence || "-" %></p>
          <p><strong>Fuel Type:</strong> <%= @vehicle.fuel_type.presence || "-" %></p>
          <p><strong>Transmission:</strong> <%= @vehicle.transmission.presence || "-" %></p>
          <p><strong>Body Style:</strong> <%= @vehicle.body_style.presence || "-" %></p>
          <p><strong>Modifications:</strong> <%= @vehicle.modifications.presence || "-" %></p>

          <% last_maintenance = @vehicle.maintenances.order(date: :desc).first %>
          <% if last_maintenance&.mileage.present? && @vehicle.mileage.present? %>
            <% next_service_mileage = last_maintenance.mileage + 5000 %>
            <% mileage_left = next_service_mileage - @vehicle.mileage %>
            <p><strong>Next Service Mileage:</strong> <%= next_service_mileage %> km</p>
            <p><strong>Mileage until next service:</strong>
              <% if mileage_left > 2000 %>
                <span class="badge bg-success"><%= mileage_left %> km</span>
              <% elsif mileage_left > 0 %>
                <span class="badge bg-warning"><%= mileage_left %> km</span>
              <% else %>
                <span class="badge bg-danger">Overdue!</span>
              <% end %>
            </p>
          <% end %>

          <%= link_to "Back to Vehicle", vehicle_path(@vehicle), class: "btn btn-outline-secondary mt-3" %>
        </div>
      </div>
    </div>

    <!-- Right Column: Maintenances & Documents -->
    <div class="col-md-8">
      <!-- Maintenance Records -->
      <h3>Maintenance Records</h3>
      <% if @maintenances.any? %>
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>Date</th>
              <th>Type</th>
              <th>Status</th>
              <th>Cost</th>
              <th>Notes</th>
              <th>Urgency</th>
              <th>Service Provider</th>
            </tr>
          </thead>
          <tbody>
            <% @maintenances.each do |m| %>
              <tr>
                <td><%= m.date %></td>
                <td><%= m.service_type %></td>
                <td><%= m.status %></td>
                <td><%= m.cost.present? ? number_to_currency(m.cost) : "-" %></td>
                <td><%= m.notes.presence || "-" %></td>
                <td>
                  <% if m.urgency_label == "Fast" %>
                    <span class="badge bg-success">Fast</span>
                  <% else %>
                    <span class="badge bg-warning">Soon</span>
                  <% end %>
                </td>
                <td><%= m.service_provider&.name || "Not assigned" %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% else %>
        <p>No maintenance records yet.</p>
      <% end %>

      <hr>

      <!-- Vehicle Documents -->
      <h3>Vehicle Documents</h3>
      <% if @documents.any? %>
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>Type</th>
              <th>Expires On</th>
              <th>File</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% @documents.each do |doc| %>
              <tr>
                <td><%= doc.doc_type %></td>
                <td><%= doc.expires_on || "-" %></td>
                <td>
                  <% if doc.file.attached? %>
                    <%= link_to "Download", rails_blob_path(doc.file, disposition: "attachment"), class: "btn btn-sm btn-info" %>
                  <% else %>
                    <span class="text-muted">No file</span>
                  <% end %>
                </td>
                <td>
                <% if doc.file.attached? %>
                    <%= button_to "Delete",
                                vehicle_vehicle_document_path(@vehicle, doc),
                                method: :delete,
                                data: { confirm: "Are you sure you want to delete this document?" },
                                class: "btn btn-sm btn-danger" %>
                <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% else %>
        <p>No documents uploaded yet.</p>
      <% end %>
    </div>
  </div>
</div>
