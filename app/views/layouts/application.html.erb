<!DOCTYPE html>
<html>
  <head>
    <title>Trinidad Fleet Management</title>

    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- DHTMLX Gantt CSS - Only load on Gantt pages -->
    <% if content_for?(:gantt_page) %>
      <link rel="stylesheet" href="https://cdn.dhtmlx.com/gantt/edge/dhtmlxgantt.css">
    <% end %>
    
    <!-- ===============================
         Stylesheets
    ================================ -->
    <%= stylesheet_link_tag "application",
          media: "all",
          "data-turbo-track": "reload" %>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    >

    <!-- ===============================
         Import Maps (Turbo + Stimulus)
    ================================ -->
    <%= javascript_importmap_tags %>

    <!-- Favicon -->
    <link rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üöó</text></svg>">

    <!-- Theme Support Styles - ALL THEMES ENHANCED -->
    <style>
    :root {
      --bg-primary: #FFFFFF;
      --bg-secondary: #F8F9FA;
      --bg-card: #FFFFFF;
      --border-color: #E9ECEF;
      --text-primary: #212529;
      --text-secondary: #6C757D;
      --primary-color: #0055A4;
      --secondary-color: #0066CC;
      --success-color: #28A745;
      --warning-color: #FFC107;
      --danger-color: #DC3545;
      --police-color: #BF0A30;
      --ptsc-color: #F1BE48;
      --fire-color: #DC3545;
    }
    
    /* ============================================
       THEME 1: MODERN LIGHT - ENHANCED
    ============================================ */
    body.theme-1 {
      background: 
        linear-gradient(135deg, #F8F9FA 0%, #E9ECEF 100%),
        url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0h100v100H0z' fill='%23FFFFFF' fill-opacity='0.2'/%3E%3Cpath d='M50 0v100M0 50h100' stroke='%23000000' stroke-width='0.5' stroke-opacity='0.05'/%3E%3C/svg%3E");
      font-family: 'Segoe UI', 'Helvetica Neue', system-ui, sans-serif;
      color: #212529;
    }
    
    body.theme-1 .navbar {
      background: linear-gradient(135deg, #2C3E50 0%, #34495E 100%) !important;
      border-bottom: 3px solid #0055A4;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      padding: 0.75rem 0;
    }
    
    body.theme-1 .navbar-brand {
      font-weight: 700;
      letter-spacing: -0.5px;
      color: white !important;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    body.theme-1 .nav-link {
      color: rgba(255, 255, 255, 0.9) !important;
      font-weight: 500;
      padding: 0.5rem 1rem !important;
      margin: 0 0.25rem;
      border-radius: 6px;
      transition: all 0.2s ease;
    }
    
    body.theme-1 .nav-link:hover {
      color: white !important;
      background: rgba(255, 255, 255, 0.15);
      transform: translateY(-1px);
    }
    
    body.theme-1 .nav-link.active {
      background: linear-gradient(135deg, #0055A4, #0066CC) !important;
      color: white !important;
      box-shadow: 0 4px 12px rgba(0, 85, 164, 0.3);
    }
    
    body.theme-1 .card {
      background: white;
      border: 2px solid #E9ECEF;
      border-radius: 12px;
      color: #212529;
      box-shadow: 
        0 8px 25px rgba(0, 0, 0, 0.08),
        inset 0 1px 0 rgba(255, 255, 255, 0.5);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    body.theme-1 .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #0055A4, #0066CC);
    }
    
    body.theme-1 .card:hover {
      transform: translateY(-6px);
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.15);
      border-color: #0055A4;
    }
    
    body.theme-1 .card-header {
      background: linear-gradient(135deg, #F8F9FA, #E9ECEF);
      border-bottom: 2px solid #0055A4;
      color: #2C3E50;
      font-weight: 700;
      padding: 1.25rem 1.5rem;
      font-size: 1.1rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    /* Police - Modern Professional */
    body.theme-1 .bg-police {
      background: linear-gradient(135deg, #2C3E50 0%, #34495E 100%) !important;
      color: white !important;
      border: 2px solid #BF0A30;
      position: relative;
      overflow: hidden;
    }
    
    body.theme-1 .bg-police::before {
      content: 'üöì';
      position: absolute;
      right: 20px;
      bottom: 20px;
      font-size: 3rem;
      opacity: 0.1;
      transform: rotate(-15deg);
    }
    
    body.theme-1 .bg-police .card-title {
      font-weight: 700;
      letter-spacing: 0.5px;
      position: relative;
      z-index: 1;
      border-left: 4px solid #BF0A30;
      padding-left: 15px;
    }
    
    /* PTSC - Modern Professional */
    body.theme-1 .bg-ptsc {
      background: linear-gradient(135deg, #F39C12 0%, #F1C40F 100%) !important;
      color: #2C3E50 !important;
      border: 2px solid #D68910;
      position: relative;
      overflow: hidden;
    }
    
    body.theme-1 .bg-ptsc::before {
      content: 'üöå';
      position: absolute;
      right: 20px;
      bottom: 20px;
      font-size: 3rem;
      opacity: 0.1;
      transform: rotate(15deg);
    }
    
    /* Status indicators */
    body.theme-1 .vehicle-status-active {
      background: linear-gradient(135deg, #D5F4E6, #A3E4D7);
      color: #186A3B;
      border-left: 4px solid #28A745;
      padding: 12px 16px;
      border-radius: 8px;
      font-weight: 600;
      display: flex;
      align-items: center;
      box-shadow: 0 4px 12px rgba(40, 167, 69, 0.1);
    }
    
    body.theme-1 .vehicle-status-active::before {
      content: '‚úÖ';
      margin-right: 12px;
      font-size: 1.2em;
    }
    
    body.theme-1 .vehicle-status-maintenance {
      background: linear-gradient(135deg, #FDEBD0, #FAD7A0);
      color: #B9770E;
      border-left: 4px solid #FFC107;
      padding: 12px 16px;
      border-radius: 8px;
      font-weight: 600;
      display: flex;
      align-items: center;
      box-shadow: 0 4px 12px rgba(255, 193, 7, 0.1);
    }
    
    body.theme-1 .vehicle-status-maintenance::before {
      content: 'üîß';
      margin-right: 12px;
      font-size: 1.2em;
    }
    
    body.theme-1 .vehicle-status-out {
      background: linear-gradient(135deg, #FADBD8, #F5B7B1);
      color: #A93226;
      border-left: 4px solid #DC3545;
      padding: 12px 16px;
      border-radius: 8px;
      font-weight: 600;
      display: flex;
      align-items: center;
      box-shadow: 0 4px 12px rgba(220, 53, 69, 0.1);
    }
    
    body.theme-1 .vehicle-status-out::before {
      content: '‚ö†Ô∏è';
      margin-right: 12px;
      font-size: 1.2em;
    }
    
    /* Tables */
    body.theme-1 .table {
      background: white;
      border: 2px solid #E9ECEF;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
    }
    
    body.theme-1 .table th {
      background: linear-gradient(135deg, #2C3E50, #34495E);
      color: white;
      font-weight: 600;
      padding: 16px;
      border-bottom: 3px solid #0055A4;
      position: relative;
    }
    
    body.theme-1 .table th::after {
      content: '';
      position: absolute;
      bottom: -3px;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #0055A4, #0066CC);
    }
    
    body.theme-1 .table-striped tbody tr:nth-of-type(odd) {
      background-color: #F8F9FA;
    }
    
    body.theme-1 .table-hover tbody tr:hover {
      background-color: #E3F2FD !important;
      transform: translateX(4px);
      transition: all 0.3s ease;
    }
    
    /* Buttons */
    body.theme-1 .btn-primary {
      background: linear-gradient(135deg, #0055A4, #0066CC);
      border: none;
      color: white;
      font-weight: 600;
      padding: 12px 24px;
      border-radius: 8px;
      box-shadow: 0 4px 15px rgba(0, 85, 164, 0.3);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    body.theme-1 .btn-primary:hover {
      background: linear-gradient(135deg, #004080, #0055A4);
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0, 85, 164, 0.4);
    }
    
    /* ============================================
       THEME 2: DARK PROFESSIONAL - ENHANCED
    ============================================ */
    body.theme-2 {
      background: 
        linear-gradient(135deg, #0F172A 0%, #1E293B 100%),
        url("data:image/svg+xml,%3Csvg width='120' height='120' viewBox='0 0 120 120' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0h120v120H0z' fill='%23000000' fill-opacity='0.03'/%3E%3Cpath d='M60 0v120M0 60h120' stroke='%23FFFFFF' stroke-width='1' stroke-opacity='0.05'/%3E%3Ccircle cx='60' cy='60' r='20' fill='%23FFFFFF' fill-opacity='0.02'/%3E%3C/svg%3E");
      color: #E2E8F0;
      font-family: 'Inter', -apple-system, sans-serif;
      font-weight: 300;
    }
    
    body.theme-2 .navbar {
      background: linear-gradient(135deg, #0F172A, #1E293B) !important;
      backdrop-filter: blur(20px);
      border-bottom: 2px solid #3B82F6;
      box-shadow: 
        0 4px 30px rgba(0, 0, 0, 0.5),
        0 0 0 1px rgba(255, 255, 255, 0.05);
    }
    
    body.theme-2 .navbar-brand {
      font-weight: 800;
      letter-spacing: -0.5px;
      background: linear-gradient(90deg, #60A5FA, #3B82F6);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 2px 10px rgba(59, 130, 246, 0.3);
    }
    
    body.theme-2 .card {
      background: linear-gradient(145deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.9));
      backdrop-filter: blur(15px);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 16px;
      color: #E2E8F0;
      box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    body.theme-2 .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, transparent, rgba(59, 130, 246, 0.05), transparent);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    body.theme-2 .card:hover::before {
      opacity: 1;
    }
    
    body.theme-2 .card-header {
      background: linear-gradient(90deg, 
        rgba(59, 130, 246, 0.2) 0%, 
        rgba(96, 165, 250, 0.1) 100%
      );
      border-bottom: 1px solid rgba(59, 130, 246, 0.3);
      color: #93C5FD;
      font-weight: 600;
      padding: 1.5rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-size: 0.9rem;
      position: relative;
    }
    
    body.theme-2 .card-header::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, #3B82F6, transparent);
    }
    
    body.theme-2 .bg-police {
      background: linear-gradient(135deg, 
        rgba(15, 23, 42, 0.95) 0%, 
        rgba(30, 41, 59, 0.98) 100%
      ) !important;
      color: #60A5FA !important;
      border: 2px solid rgba(59, 130, 246, 0.5);
      position: relative;
      overflow: hidden;
    }
    
    body.theme-2 .bg-police::before {
      content: 'POLICE';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(-45deg);
      font-size: 4rem;
      font-weight: 900;
      color: rgba(59, 130, 246, 0.05);
      letter-spacing: 10px;
    }
    
    body.theme-2 .bg-police .card-title {
      font-family: 'Courier New', monospace;
      font-weight: 700;
      text-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
      position: relative;
      z-index: 1;
      border-left: 4px solid #3B82F6;
      padding-left: 15px;
    }
    
    /* Progress bars with glow */
    body.theme-2 .progress {
      background: rgba(30, 41, 59, 0.5);
      border-radius: 10px;
      height: 12px;
      overflow: hidden;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    body.theme-2 .progress-bar {
      background: linear-gradient(90deg, #3B82F6, #60A5FA);
      border-radius: 10px;
      position: relative;
      overflow: hidden;
    }
    
    body.theme-2 .progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.4),
        transparent
      );
      animation: shimmer 2s infinite;
    }
    
    /* ============================================
       THEME 3: TRINIDAD GRADIENT - ENHANCED
    ============================================ */
    body.theme-3 {
      background: 
        radial-gradient(circle at 20% 80%, rgba(0, 85, 164, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(241, 190, 72, 0.15) 0%, transparent 50%),
        linear-gradient(135deg, #FFFFFF 0%, #F0F7FF 100%),
        url("data:image/svg+xml,%3Csvg width='80' height='80' viewBox='0 0 80 80' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0h80v80H0z' fill='%230055A4' fill-opacity='0.03'/%3E%3Cpath d='M40 0v80M0 40h80' stroke='%23F1BE48' stroke-width='1' stroke-opacity='0.1'/%3E%3C/svg%3E");
      font-family: 'Montserrat', 'Segoe UI', sans-serif;
      color: #2C3E50;
    }
    
    body.theme-3 .navbar {
      background: linear-gradient(90deg, 
        #0055A4 0%, 
        #0066CC 50%, 
        #0055A4 100%
      ) !important;
      border-bottom: 4px solid #F1BE48;
      box-shadow: 0 4px 20px rgba(0, 85, 164, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    body.theme-3 .navbar::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.2),
        transparent
      );
      animation: slide 3s infinite;
    }
    
    body.theme-3 .card {
      background: rgba(255, 255, 255, 0.92);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(0, 85, 164, 0.2);
      border-radius: 16px;
      color: #2C3E50;
      box-shadow: 
        0 8px 32px rgba(0, 85, 164, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.8);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    body.theme-3 .card::after {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, transparent 50%, rgba(241, 190, 72, 0.1) 50%);
    }
    
    body.theme-3 .bg-police {
      background: linear-gradient(135deg, 
        rgba(0, 85, 164, 0.1) 0%, 
        rgba(191, 10, 48, 0.2) 100%
      ) !important;
      border: 2px solid #BF0A30;
      color: #BF0A30 !important;
      position: relative;
    }
    
    body.theme-3 .bg-police::before {
      content: 'üáπüáπ';
      position: absolute;
      right: 15px;
      top: 15px;
      font-size: 2rem;
      opacity: 0.2;
    }
    
    /* ============================================
       THEME 4: CLEAN ADMIN - ENHANCED
    ============================================ */
    body.theme-4 {
      background: 
        linear-gradient(135deg, #F5F7FA 0%, #E4E7EB 100%),
        url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%232C3E50' fill-opacity='0.05' fill-rule='evenodd'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/svg%3E");
      font-family: 'Roboto', 'Arial', sans-serif;
      color: #34495E;
    }
    
    body.theme-4 .navbar {
      background: linear-gradient(135deg, #2C3E50 0%, #34495E 100%) !important;
      border-bottom: 3px solid #2980B9;
      box-shadow: 0 4px 15px rgba(44, 62, 80, 0.2);
    }
    
    body.theme-4 .card {
      background: white;
      border: none;
      border-top: 6px solid #2980B9;
      border-radius: 12px;
      color: #34495E;
      box-shadow: 
        0 6px 20px rgba(0, 0, 0, 0.08),
        0 1px 3px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
    }
    
    body.theme-4 .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
      border-top-color: #3498DB;
    }
    
    body.theme-4 .card-header {
      background: linear-gradient(135deg, #F5F7FA, #E4E7EB);
      border-bottom: 2px solid #2980B9;
      color: #2C3E50;
      font-weight: 700;
      padding: 1.5rem;
      font-size: 1.1rem;
      letter-spacing: 0.5px;
    }
    
    /* ============================================
       THEME 5: MAP CENTRIC - ENHANCED
    ============================================ */
    body.theme-5 {
      background: 
        linear-gradient(135deg, #E8F4FD 0%, #F0F7FF 100%),
        url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0h100v100H0z' fill='%230055A4' fill-opacity='0.03'/%3E%3Cpath d='M0 0l100 100M100 0L0 100' stroke='%230055A4' stroke-width='0.5' stroke-opacity='0.1'/%3E%3Ccircle cx='50' cy='50' r='30' fill='none' stroke='%23F1BE48' stroke-width='1' stroke-opacity='0.1' stroke-dasharray='5,5'/%3E%3C/svg%3E");
      font-family: 'Open Sans', 'Arial', sans-serif;
      color: #2D3748;
    }
    
    body.theme-5 .navbar {
      background: linear-gradient(135deg, #1E3A5F 0%, #2D4A7D 100%) !important;
      border-bottom: 3px solid #4299E1;
      box-shadow: 0 4px 20px rgba(30, 58, 95, 0.3);
      position: relative;
    }
    
    body.theme-5 .navbar::after {
      content: '';
      position: absolute;
      bottom: -3px;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #4299E1, #63B3ED);
    }
    
    body.theme-5 .card {
      background: rgba(255, 255, 255, 0.92);
      backdrop-filter: blur(15px);
      border: 2px solid rgba(66, 153, 225, 0.3);
      border-radius: 16px;
      color: #2D3748;
      box-shadow: 
        0 10px 30px rgba(66, 153, 225, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.8);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    body.theme-5 .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, transparent, rgba(66, 153, 225, 0.05), transparent);
    }
    
    body.theme-5 .bg-police {
      background: linear-gradient(135deg, 
        rgba(30, 58, 95, 0.1) 0%, 
        rgba(191, 10, 48, 0.15) 100%
      ) !important;
      border: 2px solid #BF0A30;
      color: #BF0A30 !important;
      position: relative;
    }
    
    body.theme-5 .bg-police::after {
      content: 'üìç';
      position: absolute;
      right: 15px;
      top: 15px;
      font-size: 1.5rem;
    }
    
    /* ============================================
       THEME 8: MODERN TECH/MINIMALIST - ENHANCED
       (Already good, but adding more details)
    ============================================ */
    body.theme-8 .progress {
      background: linear-gradient(135deg, 
        rgba(30, 41, 59, 0.5) 0%, 
        rgba(15, 23, 42, 0.3) 100%
      );
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 12px;
      height: 14px;
      overflow: hidden;
      box-shadow: 
        inset 0 2px 6px rgba(0, 0, 0, 0.3),
        0 1px 0 rgba(255, 255, 255, 0.1);
    }
    
    body.theme-8 .progress-bar {
      background: linear-gradient(90deg, 
        #3B82F6 0%, 
        #00D4FF 50%, 
        #3B82F6 100%
      );
      background-size: 200% 100%;
      animation: gradientShift 3s infinite linear;
      border-radius: 12px;
      position: relative;
    }
    
    /* ============================================
       THEME 9: CLASSIC/VINTAGE - ENHANCED FURTHER
    ============================================ */
    body.theme-9 .card {
      background: #FFFDD0;
      border: 3px solid #8B4513;
      border-radius: 0;
      box-shadow: 
        8px 8px 0 rgba(139, 69, 19, 0.2),
        inset 0 0 0 1px rgba(139, 69, 19, 0.1);
      padding: 25px;
      position: relative;
      transition: all 0.3s ease;
    }
    
    body.theme-9 .card::before {
      content: '';
      position: absolute;
      top: 10px;
      left: 10px;
      right: 10px;
      bottom: 10px;
      border: 2px dashed rgba(139, 69, 19, 0.3);
      pointer-events: none;
    }
    
    body.theme-9 .card::after {
      content: '‚úß';
      position: absolute;
      top: -15px;
      left: 50%;
      transform: translateX(-50%);
      background: #FFFDD0;
      color: #8B4513;
      font-size: 1.5rem;
      padding: 0 20px;
    }
    
    body.theme-9 .card-header {
      background: linear-gradient(135deg, #8B4513, #A0522D);
      color: #FFFDD0;
      border-bottom: 3px solid #704214;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 2px;
      padding: 20px;
      position: relative;
    }
    
    body.theme-9 .card-header::before {
      content: '‚ú™';
      margin-right: 15px;
    }
    
    body.theme-9 .table {
      background: #F5E6CA;
      border: 3px solid #8B4513;
      font-family: 'Courier New', monospace;
    }
    
    body.theme-9 .table th {
      background: linear-gradient(135deg, #8B4513, #A0522D);
      color: #FFFDD0;
      border-bottom: 2px solid #704214;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 1px;
      padding: 20px;
    }
    
    /* ============================================
       THEME 11: CORPORATE/PROFESSIONAL - ENHANCED
    ============================================ */
    body.theme-11 .card {
      background: white;
      border: 2px solid #E5E7EB;
      border-radius: 16px;
      color: #1F2937;
      box-shadow: 
        0 10px 30px rgba(0, 0, 0, 0.06),
        inset 0 1px 0 rgba(255, 255, 255, 0.8);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    body.theme-11 .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #1E3A8A, #2563EB, #1D4ED8);
    }
    
    body.theme-11 .card:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
      border-color: #2563EB;
    }
    
    body.theme-11 .card-header {
      background: linear-gradient(135deg, #F9FAFB, #F3F4F6);
      border-bottom: 2px solid #2563EB;
      color: #1E3A8A;
      font-weight: 700;
      padding: 1.5rem;
      font-size: 1.1rem;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }
    
    body.theme-11 .table {
      background: white;
      border: 2px solid #E5E7EB;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.04);
    }
    
    body.theme-11 .table th {
      background: linear-gradient(135deg, #1E3A8A, #2563EB);
      color: white;
      font-weight: 600;
      padding: 18px;
      border-bottom: 3px solid #1D4ED8;
    }
    
    /* ============================================
       ANIMATIONS FOR ALL THEMES
    ============================================ */
    @keyframes slide {
      0% { left: -100%; }
      100% { left: 100%; }
    }
    
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.6; }
      100% { opacity: 1; }
    }
    
    @keyframes scanLine {
      0% { left: -100%; }
      100% { left: 100%; }
    }
    
    /* ============================================
       COMMON ELEMENTS FOR ALL THEMES
    ============================================ */
    
    /* Buttons - Enhanced for all themes */
    .btn-primary {
      font-weight: 600;
      padding: 10px 24px;
      border-radius: 8px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .btn-primary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.3),
        transparent
      );
      transition: left 0.5s;
    }
    
    .btn-primary:hover::before {
      left: 100%;
    }
    
    /* Progress bars - Enhanced */
    .progress {
      border-radius: 10px;
      overflow: hidden;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .progress-bar {
      position: relative;
      overflow: hidden;
    }
    
    /* Alerts - Enhanced */
    .alert {
      border-radius: 12px;
      padding: 16px 20px;
      border-left-width: 5px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }
    
    /* Tables - Enhanced */
    .table {
      border-collapse: separate;
      border-spacing: 0;
    }
    
    .table-hover tbody tr {
      transition: all 0.2s ease;
    }
    
    /* Gantt Chart Custom Styling */
    .gantt_task_line {
      border-radius: 6px;
      opacity: 0.95;
      transition: all 0.3s ease;
    }
    
    .gantt_task_line:hover {
      opacity: 1;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 100;
      transform: scale(1.02);
    }
    
    .gantt_task_content {
      font-size: 12px;
      font-weight: 600;
      color: white;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    }
    
    .gantt_row.odd {
      background-color: rgba(0, 0, 0, 0.02);
    }
    
    .gantt_row.highlighted {
      background-color: rgba(0, 123, 255, 0.1) !important;
    }
    
    .legend-box {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      display: inline-block;
      margin-right: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    /* Status specific colors for Gantt bars */
    .gantt_completed {
      background: linear-gradient(135deg, #28a745, #20c997) !important;
      border-color: #218838 !important;
    }
    
    .gantt_overdue {
      background: linear-gradient(135deg, #dc3545, #e35d6a) !important;
      border-color: #c82333 !important;
    }
    
    .gantt_pending {
      background: linear-gradient(135deg, #ffc107, #ffd65c) !important;
      border-color: #e0a800 !important;
    }
    
    .gantt_emergency {
      background: linear-gradient(135deg, #fd7e14, #ff9e42) !important;
      border-color: #e46c10 !important;
    }
    
    .gantt_routine {
      background: linear-gradient(135deg, #0d6efd, #3d8bfd) !important;
      border-color: #0b5ed7 !important;
    }
    
    .gantt_vehicle {
      background: linear-gradient(135deg, #6c757d, #8b939b) !important;
      border-color: #5c636a !important;
    }
  </style>
  </head>

  <body class="bg-light" data-controller="theme" data-theme-value="<%= session[:theme] || '1' %>">
    <!-- Theme Preview Alert -->
    <div id="themePreviewAlert" class="theme-preview-alert" style="display: none;"></div>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
      <div class="container-fluid">
        <a class="navbar-brand" href="/">
          <i class="fas fa-car me-2"></i>Trinidad Fleet Management
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <%= link_to "Vehicle List", vehicles_path,
                    class: "nav-link #{'active' if current_page?(vehicles_path)}" %>
            </li>
            <li class="nav-item">
              <%= link_to "Usage Analytics", vehicle_usages_path,
                    class: "nav-link #{'active' if current_page?(vehicle_usages_path)}" %>
            </li>
            <li class="nav-item">
              <%= link_to "Maintenance Timeline", gantt_path,
                    class: "nav-link #{'active' if current_page?(gantt_path)}" %>
            </li>
            <li class="nav-item">
              <%= link_to "Maintenance Dashboard", maintenance_dashboard_vehicles_path,
                    class: "nav-link #{'active' if current_page?(maintenance_dashboard_vehicles_path)}" %>
            </li>
            <li class="nav-item">
              <%= link_to "Drivers", drivers_path,
                    class: "nav-link #{'active' if current_page?(drivers_path)}" %>
            </li>
            <li class="nav-item">
              <%= link_to "üé® Pick Theme", themes_vehicles_path,
                    class: "nav-link #{'active' if current_page?(themes_vehicles_path)}" %>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Flash messages + content -->
    <main class="container-fluid px-4">
      <% if notice %>
        <div class="alert alert-success alert-dismissible fade show mt-3" role="alert">
          <%= notice %>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      <% end %>

      <% if alert %>
        <div class="alert alert-danger alert-dismissible fade show mt-3" role="alert">
          <%= alert %>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      <% end %>

      <%= yield %>
    </main>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- DHTMLX Gantt JS - Only load on Gantt pages -->
    <% if content_for?(:gantt_page) %>
      <script src="https://cdn.dhtmlx.com/gantt/edge/dhtmlxgantt.js"></script>
    <% end %>

    <!-- Theme Controller Script -->
    <script>
      class ThemeController {
        constructor() {
          this.themes = {
            1: 'Modern Light',
            2: 'Dark Professional', 
            3: 'Trinidad Gradient',
            4: 'Clean Admin',
            5: 'Map-Centric',
            8: 'Modern Tech/Minimalist',
            9: 'Classic/Vintage',
            11: 'Corporate/Professional'
          };
        }
        
        initialize() {
          const themeFromSession = this.getThemeFromDataAttribute();
          const themeFromLocalStorage = localStorage.getItem('selectedTheme');
          const themeFromURL = this.getThemeFromURL();
          const themeTestMode = localStorage.getItem('themeTestMode');
          
          let themeToApply = '1';
          
          if (themeFromSession) {
            themeToApply = themeFromSession;
          } else if (themeFromLocalStorage && themeTestMode === 'true') {
            themeToApply = themeFromLocalStorage;
          } else if (themeFromURL) {
            themeToApply = themeFromURL;
            localStorage.setItem('selectedTheme', themeFromURL);
            localStorage.setItem('themeTestMode', 'true');
          }
          
          this.applyTheme(themeToApply);
          
          if (themeTestMode === 'true') {
            this.showThemePreviewAlert(themeToApply);
          }
          
          this.setupEventListeners();
        }
        
        getThemeFromDataAttribute() {
          const body = document.body;
          if (body && body.dataset.themeValue) {
            return body.dataset.themeValue;
          }
          return null;
        }
        
        getThemeFromURL() {
          const urlParams = new URLSearchParams(window.location.search);
          return urlParams.get('theme');
        }
        
        applyTheme(themeNumber) {
          const allThemeClasses = Array.from({length: 12}, (_, i) => `theme-${i}`);
          document.body.classList.remove(...allThemeClasses);
          document.body.classList.add(`theme-${themeNumber}`);
          document.body.dataset.themeValue = themeNumber;
          
          document.dispatchEvent(new CustomEvent('theme:changed', {
            detail: { theme: themeNumber }
          }));
        }
        
        showThemePreviewAlert(themeNumber) {
          const alertDiv = document.getElementById('themePreviewAlert');
          const themeName = this.themes[themeNumber] || 'Unknown Theme';
          
          alertDiv.innerHTML = `
            <div class="alert alert-warning alert-dismissible fade show mb-0 rounded-0" role="alert">
              <div class="container-fluid">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <i class="fas fa-palette me-2"></i>
                    <strong>Theme Preview Active:</strong> ${themeName}
                    <span class="ms-2 small">Changes are temporary</span>
                  </div>
                  <div>
                    <button onclick="window.themeController.clearTheme()" class="btn btn-sm btn-outline-danger">
                      <i class="fas fa-times me-1"></i> Clear Theme
                    </button>
                  </div>
                </div>
              </div>
            </div>
          `;
          
          alertDiv.style.display = 'block';
        }
        
        clearTheme() {
          localStorage.removeItem('selectedTheme');
          localStorage.removeItem('themeTestMode');
          
          const allThemeClasses = Array.from({length: 12}, (_, i) => `theme-${i}`);
          document.body.classList.remove(...allThemeClasses);
          document.body.classList.add('theme-1');
          document.body.dataset.themeValue = '1';
          
          document.getElementById('themePreviewAlert').style.display = 'none';
          
          document.dispatchEvent(new CustomEvent('theme:changed', {
            detail: { theme: '1' }
          }));
        }
        
        setupEventListeners() {
          document.addEventListener('theme:select', (event) => {
            const themeNumber = event.detail.theme;
            if (themeNumber) {
              this.applyTheme(themeNumber);
              localStorage.setItem('selectedTheme', themeNumber);
              localStorage.setItem('themeTestMode', 'true');
              this.showThemePreviewAlert(themeNumber);
            }
          });
          
          const urlParams = new URLSearchParams(window.location.search);
          const themeParam = urlParams.get('theme');
          
          if (themeParam && this.themes[themeParam]) {
            this.applyTheme(themeParam);
            localStorage.setItem('selectedTheme', themeParam);
            localStorage.setItem('themeTestMode', 'true');
            this.showThemePreviewAlert(themeParam);
          }
        }
      }
      
      document.addEventListener('DOMContentLoaded', () => {
        window.themeController = new ThemeController();
        window.themeController.initialize();
      });
      
      document.addEventListener('turbo:load', () => {
        if (!window.themeController) {
          window.themeController = new ThemeController();
        }
        window.themeController.initialize();
      });
    </script>
  </body>
</html>