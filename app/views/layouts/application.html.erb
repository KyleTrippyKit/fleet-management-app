<!DOCTYPE html>
<html>
  <head>
    <title>Trinidad Fleet Management</title>

    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- DHTMLX Gantt CSS - Only load on Gantt pages -->
    <% if content_for?(:gantt_page) %>
      <link rel="stylesheet" href="https://cdn.dhtmlx.com/gantt/edge/dhtmlxgantt.css">
    <% end %>
    
    <!-- ===============================
         Stylesheets
    ================================ -->
    <%= stylesheet_link_tag "application",
          media: "all",
          "data-turbo-track": "reload" %>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    >

    <!-- ===============================
         Import Maps (Turbo + Stimulus)
    ================================ -->
    <%= javascript_importmap_tags %>

    <!-- Favicon -->
    <link rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üöó</text></svg>">

    <!-- Theme Support Styles -->
    <style>
    :root {
      --bg-primary: #FFFFFF;
      --bg-secondary: #F8F9FA;
      --bg-card: #FFFFFF;
      --border-color: #E9ECEF;
      --text-primary: #212529;
      --text-secondary: #6C757D;
      --primary-color: #0055A4;
      --secondary-color: #0066CC;
      --success-color: #28A745;
      --warning-color: #FFC107;
      --danger-color: #DC3545;
      --police-color: #BF0A30;
      --ptsc-color: #F1BE48;
      --fire-color: #DC3545;
    }
    
    /* Theme 1: Modern Light (Default) */
    body.theme-1 {
      background: linear-gradient(135deg, var(--bg-secondary) 0%, #E9ECEF 100%);
    }
    
    /* Theme 2: Dark Professional */
    body.theme-2 {
      background: linear-gradient(135deg, #121826 0%, #1A1F2E 100%);
      color: #E2E8F0;
    }
    
    body.theme-2 .card {
      background: #1E2435;
      border-color: #2D3748;
      color: #E2E8F0;
    }
    
    body.theme-2 .text-muted {
      color: #94A3B8 !important;
    }
    
    body.theme-2 .alert-info {
      background-color: #1E293B;
      border-color: #334155;
      color: #E2E8F0;
    }
    
    body.theme-2 .navbar {
      background: #1A1F2E !important;
      border-bottom: 1px solid #2D3748;
    }
    
    body.theme-2 .nav-link {
      color: #E2E8F0 !important;
    }
    
    body.theme-2 .nav-link.active {
      background: #3B82F6 !important;
    }
    
    /* Theme 3: Trinidad Gradient */
    body.theme-3 {
      background: 
        radial-gradient(circle at 10% 20%, rgba(0, 85, 164, 0.05) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(241, 190, 72, 0.05) 0%, transparent 20%),
        #FFFFFF;
    }
    
    body.theme-3 .card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(191, 10, 48, 0.1);
    }
    
    body.theme-3 .navbar {
      background: linear-gradient(90deg, #0055A4 0%, #003366 100%) !important;
    }
    
    /* Theme 4: Clean Admin */
    body.theme-4 {
      background: #F5F7FA;
    }
    
    body.theme-4 .card {
      border-top: 4px solid var(--primary-color);
    }
    
    body.theme-4 .navbar {
      background: #2C3E50 !important;
    }
    
    /* Theme 5: Map Centric */
    body.theme-5 {
      background: 
        linear-gradient(45deg, #E8F4FD 25%, transparent 25%),
        linear-gradient(-45deg, #F0F7FF 25%, transparent 25%),
        linear-gradient(45deg, transparent 75%, #E8F4FD 75%),
        linear-gradient(-45deg, transparent 75%, #F0F7FF 75%);
      background-size: 20px 20px;
      background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
    }
    
    body.theme-5 .card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(0, 85, 164, 0.1);
    }
    
    body.theme-5 .navbar {
      background: #1E3A5F !important;
    }
    
    /* Theme 8: Modern Tech/Minimalist - ENHANCED VERSION */
    body.theme-8 {
      background-color: #0F172A;
      color: #E2E8F0;
      font-family: 'Inter', 'SF Pro Display', -apple-system, sans-serif;
      background-image: 
        radial-gradient(circle at 20% 80%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(0, 212, 255, 0.1) 0%, transparent 50%),
        linear-gradient(rgba(59, 130, 246, 0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(59, 130, 246, 0.05) 1px, transparent 1px);
      background-size: 100% 100%, 100% 100%, 30px 30px, 30px 30px;
      min-height: 100vh;
    }
    
    body.theme-8 .navbar {
      background: rgba(15, 23, 42, 0.98) !important;
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(59, 130, 246, 0.4);
      box-shadow: 
        0 4px 30px rgba(0, 0, 0, 0.5),
        0 0 50px rgba(0, 212, 255, 0.1);
    }
    
    body.theme-8 .navbar-brand {
      font-weight: 700;
      letter-spacing: -0.5px;
      background: linear-gradient(90deg, #3B82F6, #00D4FF);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 0 30px rgba(59, 130, 246, 0.3);
    }
    
    body.theme-8 .nav-link {
      color: #CBD5E1 !important;
      position: relative;
      padding: 8px 16px !important;
      border-radius: 6px;
      margin: 0 2px;
      transition: all 0.3s ease;
    }
    
    body.theme-8 .nav-link:hover {
      color: #FFFFFF !important;
      background: rgba(59, 130, 246, 0.15);
      transform: translateY(-1px);
    }
    
    body.theme-8 .nav-link.active {
      background: linear-gradient(135deg, #3B82F6, #00D4FF) !important;
      color: white !important;
      box-shadow: 
        0 4px 15px rgba(59, 130, 246, 0.4),
        0 0 20px rgba(0, 212, 255, 0.2);
      border: none;
    }
    
    body.theme-8 .card {
      background: rgba(30, 41, 59, 0.7);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 12px;
      box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.3),
        0 1px 8px rgba(59, 130, 246, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
      position: relative;
    }
    
    body.theme-8 .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.5), transparent);
    }
    
    body.theme-8 .card:hover {
      border-color: #00D4FF;
      box-shadow: 
        0 12px 40px rgba(0, 212, 255, 0.25),
        0 2px 16px rgba(59, 130, 246, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
      transform: translateY(-4px);
    }
    
    body.theme-8 .card-header {
      background: linear-gradient(90deg, 
        rgba(59, 130, 246, 0.2) 0%, 
        rgba(0, 212, 255, 0.1) 100%
      );
      border-bottom: 1px solid rgba(59, 130, 246, 0.3);
      padding: 1rem 1.5rem;
      font-weight: 600;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      font-size: 0.9rem;
      position: relative;
      overflow: hidden;
    }
    
    body.theme-8 .card-header::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, #3B82F6, transparent);
    }
    
    /* Police - Cyber theme ENHANCED */
    body.theme-8 .bg-police {
      background: linear-gradient(135deg, 
        rgba(15, 23, 42, 0.9) 0%, 
        rgba(30, 41, 59, 0.95) 100%
      ) !important;
      color: #00D4FF !important;
      border: 1px solid rgba(0, 212, 255, 0.4);
      position: relative;
      overflow: hidden;
      box-shadow: 
        0 8px 25px rgba(0, 212, 255, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }
    
    body.theme-8 .bg-police::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(0, 212, 255, 0.15),
        transparent
      );
      animation: scanLine 3s infinite linear;
    }
    
    body.theme-8 .bg-police .card-title {
      font-family: 'Courier New', monospace;
      font-weight: bold;
      text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
    }
    
    /* PTSC - Futuristic theme ENHANCED */
    body.theme-8 .bg-ptsc {
      background: linear-gradient(135deg, 
        rgba(59, 130, 246, 0.25) 0%, 
        rgba(0, 212, 255, 0.15) 100%
      ) !important;
      color: #FFFFFF !important;
      border: 1px solid rgba(59, 130, 246, 0.4);
      box-shadow: 
        0 8px 25px rgba(59, 130, 246, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }
    
    body.theme-8 .bg-ptsc .card-title {
      font-family: 'Courier New', monospace;
      font-weight: bold;
      text-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
    }
    
    /* Status indicators with tech icons - ENHANCED */
    body.theme-8 .vehicle-status-active {
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1));
      color: #4ADE80;
      border-left: 4px solid #4ADE80;
      padding: 10px 15px;
      border-radius: 6px;
      position: relative;
      font-weight: 500;
      box-shadow: 0 4px 15px rgba(34, 197, 94, 0.1);
    }
    
    body.theme-8 .vehicle-status-active::before {
      content: '‚úì';
      margin-right: 10px;
      font-weight: bold;
      font-size: 1.1em;
      animation: pulse 2s infinite;
    }
    
    body.theme-8 .vehicle-status-maintenance {
      background: linear-gradient(135deg, rgba(234, 179, 8, 0.2), rgba(234, 179, 8, 0.1));
      color: #FBBF24;
      border-left: 4px solid #FBBF24;
      padding: 10px 15px;
      border-radius: 6px;
      position: relative;
      font-weight: 500;
      box-shadow: 0 4px 15px rgba(234, 179, 8, 0.1);
    }
    
    body.theme-8 .vehicle-status-maintenance::before {
      content: '‚öôÔ∏è';
      margin-right: 10px;
      font-size: 1.1em;
      animation: spin 4s infinite linear;
    }
    
    body.theme-8 .vehicle-status-out {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1));
      color: #F87171;
      border-left: 4px solid #F87171;
      padding: 10px 15px;
      border-radius: 6px;
      position: relative;
      font-weight: 500;
      box-shadow: 0 4px 15px rgba(239, 68, 68, 0.1);
    }
    
    body.theme-8 .vehicle-status-out::before {
      content: '‚ö†Ô∏è';
      margin-right: 10px;
      font-size: 1.1em;
      animation: blink 1.5s infinite;
    }
    
    /* Data visualization ENHANCED */
    body.theme-8 .progress {
      background-color: rgba(100, 116, 139, 0.2);
      border-radius: 10px;
      overflow: hidden;
      height: 12px;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    body.theme-8 .progress-bar {
      background: linear-gradient(90deg, #3B82F6, #00D4FF);
      position: relative;
      border-radius: 10px;
    }
    
    body.theme-8 .progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.4),
        transparent
      );
      animation: shimmer 3s infinite;
    }
    
    /* Tables ENHANCED */
    body.theme-8 .table {
      color: #E2E8F0;
      border-collapse: separate;
      border-spacing: 0;
      border-radius: 8px;
      overflow: hidden;
    }
    
    body.theme-8 .table th {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(0, 212, 255, 0.2));
      color: white;
      font-weight: 600;
      padding: 15px;
      border: none;
      position: relative;
    }
    
    body.theme-8 .table th::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.5), transparent);
    }
    
    body.theme-8 .table-striped tbody tr:nth-of-type(odd) {
      background-color: rgba(30, 41, 59, 0.5);
    }
    
    body.theme-8 .table-hover tbody tr:hover {
      background-color: rgba(59, 130, 246, 0.2) !important;
      transform: translateX(4px);
      transition: all 0.3s ease;
    }
    
    /* Buttons ENHANCED */
    body.theme-8 .btn-primary {
      background: linear-gradient(135deg, #3B82F6, #00D4FF);
      border: none;
      color: white;
      font-weight: 600;
      padding: 10px 20px;
      border-radius: 8px;
      box-shadow: 
        0 4px 15px rgba(59, 130, 246, 0.4),
        0 0 20px rgba(0, 212, 255, 0.2);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    body.theme-8 .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 
        0 8px 25px rgba(59, 130, 246, 0.6),
        0 0 30px rgba(0, 212, 255, 0.3);
    }
    
    body.theme-8 .btn-primary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.2),
        transparent
      );
      transition: left 0.5s;
    }
    
    body.theme-8 .btn-primary:hover::before {
      left: 100%;
    }
    
    /* Alerts ENHANCED */
    body.theme-8 .alert {
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 15px 20px;
      margin-bottom: 20px;
    }
    
    body.theme-8 .alert-success {
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1));
      border-color: rgba(34, 197, 94, 0.3);
      color: #4ADE80;
    }
    
    body.theme-8 .alert-warning {
      background: linear-gradient(135deg, rgba(234, 179, 8, 0.2), rgba(234, 179, 8, 0.1));
      border-color: rgba(234, 179, 8, 0.3);
      color: #FBBF24;
    }
    
    body.theme-8 .alert-danger {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1));
      border-color: rgba(239, 68, 68, 0.3);
      color: #F87171;
    }
    
    /* Theme 9: Classic/Vintage - KEEP AS IS (already impactful) */
    body.theme-9 {
      background: linear-gradient(135deg, #F5E6CA 0%, #F8F4E6 100%);
      background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23704214' fill-opacity='0.03' fill-rule='evenodd'/%3E%3C/svg%3E");
      font-family: 'Georgia', 'Times New Roman', serif;
      color: #704214;
    }
    
    /* Theme 11: Corporate/Professional - ENHANCED VERSION */
    body.theme-11 {
      background: linear-gradient(135deg, #F9FAFB 0%, #F3F4F6 100%);
      color: #1F2937;
      font-family: 'Roboto', 'Segoe UI', system-ui, sans-serif;
      line-height: 1.6;
      font-size: 15px;
    }
    
    body.theme-11 .navbar {
      background: linear-gradient(90deg, #1E3A8A 0%, #1D4ED8 100%) !important;
      box-shadow: 0 4px 20px rgba(30, 58, 138, 0.15);
      padding: 0.75rem 0;
    }
    
    body.theme-11 .navbar-brand {
      font-weight: 700;
      font-size: 1.25rem;
      letter-spacing: -0.5px;
      color: white !important;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    body.theme-11 .nav-link {
      color: rgba(255, 255, 255, 0.9) !important;
      font-weight: 500;
      padding: 0.5rem 1rem !important;
      margin: 0 0.25rem;
      border-radius: 6px;
      transition: all 0.2s ease;
    }
    
    body.theme-11 .nav-link:hover {
      color: white !important;
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-1px);
    }
    
    body.theme-11 .nav-link.active {
      background: rgba(255, 255, 255, 0.2) !important;
      color: white !important;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    body.theme-11 .card {
      background: white;
      border: 1px solid #E5E7EB;
      border-radius: 12px;
      color: #374151;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
    }
    
    body.theme-11 .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.1);
      border-color: #D1D5DB;
    }
    
    body.theme-11 .card-header {
      background: linear-gradient(90deg, #F9FAFB, #F3F4F6);
      border-bottom: 2px solid #E5E7EB;
      color: #1F2937;
      font-weight: 600;
      padding: 1.25rem 1.5rem;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    /* Police - Corporate Professional */
    body.theme-11 .bg-police {
      background: linear-gradient(135deg, #1F2937 0%, #374151 100%) !important;
      color: white !important;
      border: 2px solid #BF0A30;
      position: relative;
      overflow: hidden;
    }
    
    body.theme-11 .bg-police::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, rgba(191, 10, 48, 0.1), transparent);
      border-radius: 0 0 0 60px;
    }
    
    body.theme-11 .bg-police .card-title {
      font-weight: 700;
      letter-spacing: 0.5px;
      position: relative;
      z-index: 1;
    }
    
    body.theme-11 .bg-police .card-text {
      color: rgba(255, 255, 255, 0.9);
    }
    
    /* PTSC - Corporate Professional */
    body.theme-11 .bg-ptsc {
      background: linear-gradient(135deg, #F1BE48 0%, #F59E0B 100%) !important;
      color: #1F2937 !important;
      border: 2px solid #D97706;
      position: relative;
      overflow: hidden;
    }
    
    body.theme-11 .bg-ptsc::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), transparent);
      border-radius: 0 0 0 60px;
    }
    
    body.theme-11 .bg-ptsc .card-title {
      font-weight: 700;
      letter-spacing: 0.5px;
      position: relative;
      z-index: 1;
    }
    
    /* Status indicators */
    body.theme-11 .vehicle-status-active {
      background: linear-gradient(135deg, #D1FAE5, #A7F3D0);
      color: #065F46;
      border-left: 4px solid #059669;
      padding: 10px 15px;
      border-radius: 8px;
      font-weight: 500;
      display: flex;
      align-items: center;
    }
    
    body.theme-11 .vehicle-status-active::before {
      content: '‚úì';
      margin-right: 10px;
      font-weight: bold;
      font-size: 1.1em;
      color: #059669;
    }
    
    body.theme-11 .vehicle-status-maintenance {
      background: linear-gradient(135deg, #FEF3C7, #FDE68A);
      color: #92400E;
      border-left: 4px solid #D97706;
      padding: 10px 15px;
      border-radius: 8px;
      font-weight: 500;
      display: flex;
      align-items: center;
    }
    
    body.theme-11 .vehicle-status-maintenance::before {
      content: '‚öôÔ∏è';
      margin-right: 10px;
      font-size: 1.1em;
    }
    
    body.theme-11 .vehicle-status-out {
      background: linear-gradient(135deg, #FEE2E2, #FCA5A5);
      color: #991B1B;
      border-left: 4px solid #DC2626;
      padding: 10px 15px;
      border-radius: 8px;
      font-weight: 500;
      display: flex;
      align-items: center;
    }
    
    body.theme-11 .vehicle-status-out::before {
      content: '‚ö†Ô∏è';
      margin-right: 10px;
      font-size: 1.1em;
    }
    
    /* Tables */
    body.theme-11 .table {
      background: white;
      border: 1px solid #E5E7EB;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
    }
    
    body.theme-11 .table th {
      background: linear-gradient(135deg, #F9FAFB, #F3F4F6);
      color: #374151;
      font-weight: 600;
      padding: 16px;
      border-bottom: 2px solid #E5E7EB;
    }
    
    body.theme-11 .table td {
      padding: 14px 16px;
      border-top: 1px solid #F3F4F6;
    }
    
    body.theme-11 .table-striped tbody tr:nth-of-type(odd) {
      background-color: #F9FAFB;
    }
    
    body.theme-11 .table-hover tbody tr:hover {
      background-color: #F3F4F6 !important;
      transform: translateX(2px);
      transition: all 0.2s ease;
    }
    
    /* Buttons */
    body.theme-11 .btn-primary {
      background: linear-gradient(135deg, #2563EB, #1D4ED8);
      border: none;
      color: white;
      font-weight: 600;
      padding: 10px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
      transition: all 0.3s ease;
    }
    
    body.theme-11 .btn-primary:hover {
      background: linear-gradient(135deg, #1D4ED8, #1E40AF);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(37, 99, 235, 0.3);
    }
    
    body.theme-11 .btn-outline-primary {
      color: #2563EB;
      border: 2px solid #2563EB;
      font-weight: 600;
      padding: 8px 18px;
      border-radius: 8px;
      transition: all 0.3s ease;
    }
    
    body.theme-11 .btn-outline-primary:hover {
      background: linear-gradient(135deg, #2563EB, #1D4ED8);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(37, 99, 235, 0.2);
    }
    
    /* Progress bars */
    body.theme-11 .progress {
      background-color: #F3F4F6;
      border-radius: 10px;
      height: 10px;
      overflow: hidden;
    }
    
    body.theme-11 .progress-bar {
      background: linear-gradient(90deg, #2563EB, #3B82F6);
      border-radius: 10px;
    }
    
    /* Alerts */
    body.theme-11 .alert {
      border-radius: 10px;
      border: none;
      padding: 16px 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }
    
    body.theme-11 .alert-success {
      background: linear-gradient(135deg, #D1FAE5, #A7F3D0);
      color: #065F46;
      border-left: 4px solid #059669;
    }
    
    body.theme-11 .alert-warning {
      background: linear-gradient(135deg, #FEF3C7, #FDE68A);
      color: #92400E;
      border-left: 4px solid #D97706;
    }
    
    body.theme-11 .alert-danger {
      background: linear-gradient(135deg, #FEE2E2, #FCA5A5);
      color: #991B1B;
      border-left: 4px solid #DC2626;
    }
    
    /* Animations */
    @keyframes scanLine {
      0% { left: -100%; }
      100% { left: 100%; }
    }
    
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }
    
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    /* Gantt Chart Custom Styling */
    .gantt_task_line {
      border-radius: 4px;
      opacity: 0.9;
    }
    
    .gantt_task_line:hover {
      opacity: 1;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      z-index: 100;
    }
    
    .gantt_task_content {
      font-size: 12px;
      font-weight: 500;
      color: white;
      text-shadow: 1px 1px 1px rgba(0,0,0,0.3);
    }
    
    .gantt_row.odd {
      background-color: #f8f9fa;
    }
    
    .gantt_row.highlighted {
      background-color: #e7f1ff !important;
    }
    
    .legend-box {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      display: inline-block;
    }
    
    /* Status specific colors for Gantt bars */
    .gantt_completed {
      background-color: #28a745 !important;
      border-color: #218838 !important;
    }
    
    .gantt_overdue {
      background-color: #dc3545 !important;
      border-color: #c82333 !important;
    }
    
    .gantt_pending {
      background-color: #ffc107 !important;
      border-color: #e0a800 !important;
    }
    
    .gantt_emergency {
      background-color: #fd7e14 !important;
      border-color: #e46c10 !important;
    }
    
    .gantt_routine {
      background-color: #0d6efd !important;
      border-color: #0b5ed7 !important;
    }
    
    .gantt_vehicle {
      background-color: #6c757d !important;
      border-color: #5c636a !important;
    }
  </style>
  </head>

  <body class="bg-light" data-controller="theme" data-theme-value="<%= session[:theme] || '1' %>">
    <!-- Theme Preview Alert -->
    <div id="themePreviewAlert" class="theme-preview-alert" style="display: none;"></div>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
      <div class="container-fluid">
        <a class="navbar-brand" href="/">
          <i class="fas fa-car me-2"></i>Trinidad Fleet Management
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <%= link_to "Vehicle List", vehicles_path,
                    class: "nav-link #{'active' if current_page?(vehicles_path)}" %>
            </li>
            <li class="nav-item">
              <%= link_to "Usage Analytics", vehicle_usages_path,
                    class: "nav-link #{'active' if current_page?(vehicle_usages_path)}" %>
            </li>
            <li class="nav-item">
              <%= link_to "Maintenance Timeline", gantt_path,
                    class: "nav-link #{'active' if current_page?(gantt_path)}" %>
            </li>
            <li class="nav-item">
              <%= link_to "Maintenance Dashboard", maintenance_dashboard_vehicles_path,
                    class: "nav-link #{'active' if current_page?(maintenance_dashboard_vehicles_path)}" %>
            </li>
            <li class="nav-item">
              <%= link_to "Drivers", drivers_path,
                    class: "nav-link #{'active' if current_page?(drivers_path)}" %>
            </li>
            <li class="nav-item">
              <%= link_to "üé® Pick Theme", themes_vehicles_path,
                    class: "nav-link #{'active' if current_page?(themes_vehicles_path)}" %>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Flash messages + content -->
    <main class="container-fluid px-4">
      <% if notice %>
        <div class="alert alert-success alert-dismissible fade show mt-3" role="alert">
          <%= notice %>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      <% end %>

      <% if alert %>
        <div class="alert alert-danger alert-dismissible fade show mt-3" role="alert">
          <%= alert %>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      <% end %>

      <%= yield %>
    </main>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- DHTMLX Gantt JS - Only load on Gantt pages -->
    <% if content_for?(:gantt_page) %>
      <script src="https://cdn.dhtmlx.com/gantt/edge/dhtmlxgantt.js"></script>
    <% end %>

    <!-- Theme Controller Script - UPDATED FOR ALL THEMES -->
    <script>
      class ThemeController {
        constructor() {
          this.themes = {
            1: 'Modern Light',
            2: 'Dark Professional', 
            3: 'Trinidad Gradient',
            4: 'Clean Admin',
            5: 'Map-Centric',
            6: 'Dark Professional (External)',
            7: 'Map Centric (External)',
            8: 'Modern Tech/Minimalist',
            9: 'Classic/Vintage',
            10: 'Corporate/Professional'
          };
          
          // Add theme 11 if you have it
          this.themes[11] = 'Corporate/Professional';
          
          // Define which themes should apply navbar styling
          this.darkNavbarThemes = [2, 8];
        }
        
        initialize() {
          console.log("üé® ThemeController initializing...");
          
          // Check for theme in multiple places (in order of priority)
          const themeFromSession = this.getThemeFromDataAttribute();
          const themeFromLocalStorage = localStorage.getItem('selectedTheme');
          const themeFromURL = this.getThemeFromURL();
          const themeTestMode = localStorage.getItem('themeTestMode');
          
          let themeToApply = '1'; // Default
          
          if (themeFromSession) {
            console.log("üé® Theme from session/data-attr:", themeFromSession);
            themeToApply = themeFromSession;
          } else if (themeFromLocalStorage && themeTestMode === 'true') {
            console.log("üé® Theme from localStorage:", themeFromLocalStorage);
            themeToApply = themeFromLocalStorage;
          } else if (themeFromURL) {
            console.log("üé® Theme from URL:", themeFromURL);
            themeToApply = themeFromURL;
            localStorage.setItem('selectedTheme', themeFromURL);
            localStorage.setItem('themeTestMode', 'true');
          }
          
          this.applyTheme(themeToApply);
          
          // Show preview alert if in test mode
          if (themeTestMode === 'true') {
            this.showThemePreviewAlert(themeToApply);
          }
          
          this.setupEventListeners();
        }
        
        getThemeFromDataAttribute() {
          const body = document.body;
          if (body && body.dataset.themeValue) {
            return body.dataset.themeValue;
          }
          return null;
        }
        
        getThemeFromURL() {
          const urlParams = new URLSearchParams(window.location.search);
          return urlParams.get('theme');
        }
        
        applyTheme(themeNumber) {
          console.log("üé® Applying theme:", themeNumber);
          
          // Remove ALL theme classes
          const allThemeClasses = Array.from({length: 11}, (_, i) => `theme-${i+1}`);
          document.body.classList.remove(...allThemeClasses);
          
          // Add the selected theme class
          document.body.classList.add(`theme-${themeNumber}`);
          
          // Apply CSS variables for the theme
          this.applyThemeVariables(themeNumber);
          
          // Apply navbar styling if needed
          this.applyNavbarStyling(themeNumber);
          
          // Update data attribute
          document.body.dataset.themeValue = themeNumber;
          
          // Dispatch event for other scripts to listen to
          document.dispatchEvent(new CustomEvent('theme:changed', {
            detail: { theme: themeNumber }
          }));
        }
        
        applyThemeVariables(themeNumber) {
          const themes = {
            1: {'--bg-primary': '#FFFFFF', '--bg-secondary': '#F8F9FA', '--text-primary': '#212529'},
            2: {'--bg-primary': '#121826', '--bg-secondary': '#1A1F2E', '--text-primary': '#E2E8F0'},
            3: {'--bg-primary': 'linear-gradient(135deg, #FFFFFF 0%, #E8F4FD 100%)', '--bg-secondary': '#FFFFFF', '--text-primary': '#212529'},
            4: {'--bg-primary': '#F5F7FA', '--bg-secondary': '#FFFFFF', '--text-primary': '#2C3E50'},
            5: {'--bg-primary': '#F0F2F5', '--bg-secondary': '#FFFFFF', '--text-primary': '#1A202C'},
            8: {'--bg-primary': '#0F172A', '--bg-secondary': '#1E293B', '--text-primary': '#E2E8F0'},
            9: {'--bg-primary': '#F5E6CA', '--bg-secondary': '#FFFDD0', '--text-primary': '#704214'},
            11: {'--bg-primary': '#F9FAFB', '--bg-secondary': '#FFFFFF', '--text-primary': '#374151'}
          };
          
          const theme = themes[themeNumber] || themes[1];
          Object.entries(theme).forEach(([key, value]) => {
            document.documentElement.style.setProperty(key, value);
          });
        }
        
        applyNavbarStyling(themeNumber) {
          const navbar = document.querySelector('.navbar');
          if (!navbar) return;
          
          // Remove all theme-specific navbar classes
          navbar.classList.remove('navbar-dark', 'navbar-light');
          navbar.classList.remove('bg-dark', 'bg-light');
          
          // For dark themes, use navbar-dark
          if (this.darkNavbarThemes.includes(parseInt(themeNumber))) {
            navbar.classList.add('navbar-dark');
            navbar.classList.add('bg-dark');
          } else {
            // For light themes, check if theme has custom navbar styling
            // If not, default to dark navbar
            const themeHasCustomNavbar = [3, 4, 5, 8, 9, 11].includes(parseInt(themeNumber));
            if (themeHasCustomNavbar) {
              navbar.classList.add('navbar-light');
              navbar.classList.add('bg-light');
            } else {
              navbar.classList.add('navbar-dark');
              navbar.classList.add('bg-dark');
            }
          }
        }
        
        showThemePreviewAlert(themeNumber) {
          const alertDiv = document.getElementById('themePreviewAlert');
          const themeName = this.themes[themeNumber] || 'Unknown Theme';
          
          alertDiv.innerHTML = `
            <div class="alert alert-warning alert-dismissible fade show mb-0 rounded-0" role="alert">
              <div class="container-fluid">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <i class="fas fa-palette me-2"></i>
                    <strong>Theme Preview Active:</strong> ${themeName}
                    <span class="ms-2 small">Changes are temporary</span>
                  </div>
                  <div>
                    <button onclick="window.themeController.clearTheme()" class="btn btn-sm btn-outline-danger">
                      <i class="fas fa-times me-1"></i> Clear Theme
                    </button>
                  </div>
                </div>
              </div>
            </div>
          `;
          
          alertDiv.style.display = 'block';
        }
        
        clearTheme() {
          console.log("üé® Clearing theme preview");
          localStorage.removeItem('selectedTheme');
          localStorage.removeItem('themeTestMode');
          
          // Remove all theme classes
          const allThemeClasses = Array.from({length: 11}, (_, i) => `theme-${i+1}`);
          document.body.classList.remove(...allThemeClasses);
          
          // Apply default theme
          document.body.classList.add('theme-1');
          this.applyThemeVariables(1);
          
          // Reset navbar to default
          const navbar = document.querySelector('.navbar');
          if (navbar) {
            navbar.classList.remove('navbar-light', 'bg-light');
            navbar.classList.add('navbar-dark', 'bg-dark');
          }
          
          // Hide alert
          document.getElementById('themePreviewAlert').style.display = 'none';
          
          // Update data attribute
          document.body.dataset.themeValue = '1';
          
          this.showToast('Theme preview cleared.', 'success');
          
          // Dispatch theme change event
          document.dispatchEvent(new CustomEvent('theme:changed', {
            detail: { theme: '1' }
          }));
        }
        
        setupEventListeners() {
          // Listen for theme change events from other parts of the app
          document.addEventListener('theme:select', (event) => {
            const themeNumber = event.detail.theme;
            if (themeNumber) {
              this.applyTheme(themeNumber);
              localStorage.setItem('selectedTheme', themeNumber);
              localStorage.setItem('themeTestMode', 'true');
              this.showThemePreviewAlert(themeNumber);
            }
          });
          
          // Handle URL theme parameter
          const urlParams = new URLSearchParams(window.location.search);
          const themeParam = urlParams.get('theme');
          
          if (themeParam && this.themes[themeParam]) {
            console.log("üé® Theme parameter found in URL:", themeParam);
            this.applyTheme(themeParam);
            localStorage.setItem('selectedTheme', themeParam);
            localStorage.setItem('themeTestMode', 'true');
            this.showThemePreviewAlert(themeParam);
          }
        }
        
        showToast(message, type = 'info') {
          const toastId = 'toast-' + Date.now();
          const toastHtml = `
            <div id="${toastId}" class="toast align-items-center text-bg-${type} border-0" role="alert">
              <div class="d-flex">
                <div class="toast-body">${message}</div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
              </div>
            </div>
          `;
          
          let container = document.getElementById('toastContainer');
          if (!container) {
            container = document.createElement('div');
            container.id = 'toastContainer';
            container.className = 'toast-container position-fixed bottom-0 end-0 p-3';
            container.style.zIndex = '9999';
            document.body.appendChild(container);
          }
          
          container.innerHTML += toastHtml;
          const toastElement = document.getElementById(toastId);
          const toast = new bootstrap.Toast(toastElement, { delay: 3000 });
          toast.show();
          
          toastElement.addEventListener('hidden.bs.toast', function () {
            this.remove();
          });
        }
      }
      
      // Initialize theme controller
      document.addEventListener('DOMContentLoaded', () => {
        console.log("üé® DOM loaded, initializing theme controller");
        window.themeController = new ThemeController();
        window.themeController.initialize();
      });
      
      // Handle Turbo page changes
      document.addEventListener('turbo:load', () => {
        console.log("üé® Turbo load event, re-initializing theme controller");
        if (!window.themeController) {
          window.themeController = new ThemeController();
        }
        window.themeController.initialize();
      });
      
      // Listen for theme changes and re-apply on AJAX updates
      document.addEventListener('ajax:success', () => {
        if (window.themeController) {
          setTimeout(() => window.themeController.initialize(), 100);
        }
      });
    </script>

    <!-- Load Chart.js only on pages that need it -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Check if we're on a page that needs Chart.js
        const needsChart = 
          window.location.pathname.includes('analytics') ||
          window.location.pathname.includes('dashboard') ||
          document.querySelector('[data-chart]') ||
          document.querySelector('.chart-container') ||
          document.querySelector('#chart');
        
        if (needsChart) {
          // Wait a bit to see if importmap loaded it
          setTimeout(function() {
            if (!window.Chart) {
              console.log("üìä Loading Chart.js for analytics/dashboard...");
              const script = document.createElement('script');
              script.src = "https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.js";
              script.onload = function() {
                console.log("‚úÖ Chart.js loaded for this page");
                document.dispatchEvent(new CustomEvent('chartjs-loaded'));
              };
              document.head.appendChild(script);
            } else {
              console.log("‚úÖ Chart.js already available");
            }
          }, 500);
        }
      });
      
      // Listen for theme changes and update charts if they exist
      document.addEventListener('theme:changed', function(event) {
        console.log("üé® Theme changed to:", event.detail.theme);
        // You could add logic here to update chart colors based on theme
      });
    </script>
  </body>
</html>